/* MuleGIS 2013-12-13 */
MuleGIS=function(){version="0.1",this.getVersion=function(){return version}},MuleGIS.Control=function(){MuleGIS.call(this),this.id=null,this.name="control",this.div=null,this.map=null,this.setMap=function(a){this.map=a},CLASS_NAME="MuleGIS.Control"},MuleGIS.Control.prototype=new OpenLayers.Control,MuleGIS.Control.DrawFeature=function(){MuleGIS.Control.call(this);var a=!1,b=!1,c=this,d=new OpenLayers.Layer.Vector("动态标绘图层");d.styleMap.styles.default.defaultStyle.strokeColor="#0004EE",d.styleMap.styles.default.defaultStyle.strokeWidth=2;var e=new OpenLayers.Control.DrawFeature(d,MuleGIS.Handler.Point),f=new OpenLayers.Control.DrawFeature(d,MuleGIS.Handler.Path),g=new OpenLayers.Control.DrawFeature(d,MuleGIS.Handler.Polygon),h=new OpenLayers.Control.ModifyFeature(d);this.clickFeature=function(a){d.removeFeatures([a])};var i=new OpenLayers.Handler.Feature(this,d,{click:this.clickFeature});this.controls=[],this.elements=[],this.initilize=function(){this.controls.push(e),this.controls.push(f),this.controls.push(g),this.controls.push(h)},this.initilize(),this.draw=function(){var a=document.createElement("div");a.id=OpenLayers.Util.createUniqueID("drawFeature_"),a.className="map-control panel panel-default",a.style.position="relative",a.style.top="0px",a.style.left="100px",a.style.zIndex="2001",a.style.width="300px";var b=document.createElement("div");b.className="panel-heading",a.appendChild(b);var c=document.createElement("span");c.className="panel-title layer-tree-title",c.innerText="动态标绘",b.appendChild(c);var d=document.createElement("span");d.className="ui-button-icon-primary ui-icon ui-icon-close layer-tree-close",d.id=OpenLayers.Util.createUniqueID("draw_feature_close_"),b.appendChild(d),contentBody=document.createElement("div"),contentBody.className="panel-body draw-feature-body";var e=document.createElement("div");e.className="draw-div draw-point-div";var f=document.createElement("div");f.className="draw-point",f.title="画点",e.appendChild(f),contentBody.appendChild(e),this.elements.pointDiv=e;var g=document.createElement("div");g.className="draw-div draw-line-div";var h=document.createElement("div");h.className="draw-line",h.title="画线",g.appendChild(h),contentBody.appendChild(g),this.elements.lineDiv=g;var i=document.createElement("div");i.className="draw-div draw-polygon-div";var j=document.createElement("div");j.className="draw-polygon",j.title="画多边形",i.appendChild(j),contentBody.appendChild(i),this.elements.polygonDiv=i;var k=document.createElement("div");k.className="draw-div modify-draw-div";var l=document.createElement("div");l.className="modify-draw",l.title="修改图形",k.appendChild(l),contentBody.appendChild(k),this.elements.modifyDiv=k;var m=document.createElement("div");m.className="draw-div delete-draw-div";var n=document.createElement("div");return n.className="delete-draw",n.title="删除图形",m.appendChild(n),this.elements.deleteDiv=m,contentBody.appendChild(m),a.appendChild(contentBody),this.div=a,this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({click:this.onClick,mousedown:this.onMouseDown,mouseup:this.onMouseUp}),this.div.style.display="none",this.div},this.onClick=function(){var a=event.srcElement;a&&("SPAN"===a.nodeName&&0===a.id.indexOf("draw_feature_close_")?this.toggle():a.className.indexOf("draw-point")>=0?(this.removeSelectedClass(),e.active===!0?this.activeControl(null):(this.activeControl(e),OpenLayers.Element.addClass(this.elements.pointDiv,"draw-div-selected"))):0===a.className.indexOf("draw-line")?(this.removeSelectedClass(),f.active===!0?this.activeControl(null):(this.activeControl(f),OpenLayers.Element.addClass(this.elements.lineDiv,"draw-div-selected"))):0===a.className.indexOf("draw-polygon")?(this.removeSelectedClass(),g.active===!0?this.activeControl(null):(this.activeControl(g),OpenLayers.Element.addClass(this.elements.polygonDiv,"draw-div-selected"))):0===a.className.indexOf("modify-draw")?(this.removeSelectedClass(),h.active===!0?this.activeControl(null):(this.activeControl(h),OpenLayers.Element.addClass(this.elements.modifyDiv,"draw-div-selected"))):0===a.className.indexOf("delete-draw")&&(this.removeSelectedClass(),i.active===!0?(this.activeControl(null),i.deactivate()):(this.activeControl(null),i.activate(),OpenLayers.Element.addClass(this.elements.deleteDiv,"draw-div-selected"))))},this.activeControl=function(a){for(var b=0;b<this.controls.length;b++)this.controls[b]===a?this.controls[b].activate():this.controls[b].deactivate()},this.removeSelectedClass=function(){for(var a in this.elements){var b=this.elements[a];void 0!==b&&OpenLayers.Element.removeClass(b,"draw-div-selected")}},this.setMap=function(a){this.map=a,i.setMap(a),this.map.addControls(this.controls),this.map.addLayer(d)},this.setFeatureAdded=function(a){e.featureAdded=a,f.featureAdded=a,g.featureAdded=a},this.toggle=function(){a=!a,a?c.div.style.display="":(this.activeControl(null),c.div.style.display="none")},this.onMouseDown=function(){b=!0,this.events.on({mousemove:this.onMouseMove}),dragX=event.clientX,dragY=event.clientY},this.onMouseUp=function(){b=!1,this.events.un({mousemove:this.onMouseMove})},this.onMouseMove=function(){if(b){var a=event.clientX-dragX,c=event.clientY-dragY;dragX=event.clientX,dragY=event.clientY;var d=parseInt(this.div.style.top.replace("px",""),0),e=parseInt(this.div.style.left.replace("px",""),0);e+=a,d+=c,this.div.style.top=d+"px",this.div.style.left=e+"px"}}},MuleGIS.Control.FeatureManager=function(){MuleGIS.Control.call(this);var a=this;this.div="",this.version="1.0.0",this.url="http://localhost:8080/geoserver/wfs",this.srsName="EPSG:4326",this.featureNS="http://www.neusoft.com/china",this.featurePrefix="china",this.featureType="house",this.geometryName="geom",this.layerName="编辑图层",this.vectorLayer=null,this.autoSave=!1,this.saveStrategy=new OpenLayers.Strategy.Save({auto:this.autoSave}),this.refreshStrategy=new OpenLayers.Strategy.Refresh,this.schema="http://192.168.196.189:8080/geoserver/wfs/DescribeFeatureType?version=1.1.0&typename=china:house";var b=OpenLayers.Util.getParameters(window.location.href).renderer;b=b?[b]:OpenLayers.Layer.Vector.prototype.renderers,this.initialize=function(){this.map&&(this.vectorLayer=new OpenLayers.Layer.Vector(this.layerName,{projection:new OpenLayers.Projection(this.srsName),strategies:[new OpenLayers.Strategy.BBOX,this.saveStrategy,this.refreshStrategy],protocol:new OpenLayers.Protocol.WFS({version:this.version,url:this.url,featureType:this.featureType,featureNS:this.featureNS,srsName:this.srsName,isBaseLayer:!1,geometryName:this.geometryName}),renderers:b}),this.map&&this.vectorLayer&&this.map.addLayer(this.vectorLayer),this.schema=this.url+"/DescribeFeatureType?version="+this.version+"&typename="+this.featurePrefix+":"+this.featureType,OpenLayers.Request.GET({url:this.schema,success:this.complete}))},this.complete=function(b){var c=new OpenLayers.Format.WFSDescribeFeatureType,d=c.read(b.responseXML||b.responseText);if(d&&d.featureTypes&&d.featureTypes[0].properties)for(var e=0,f=d.featureTypes[0].properties.length;f>e;e++){var g=d.featureTypes[0].properties[e];if(g&&g.name===a.geometryName){var h=g.type,i=null,j=!1;h.indexOf("Point")>0?i=OpenLayers.Handler.Point:h.indexOf("Line")>0?i=OpenLayers.Handler.Path:h.indexOf("Polygon")>0&&(i=OpenLayers.Handler.Polygon),h.indexOf("Multi")>0&&(j=!0),a.drawControl=new OpenLayers.Control.DrawFeature(a.vectorLayer,i,{handlerOptions:{multi:j},map:this.map}),a.editControl=new OpenLayers.Control.ModifyFeature(a.vectorLayer,{map:this.map}),a.deleteControl=new MuleGIS.Control.DeleteFeature(a.vectorLayer,this.map)}}},this.draw=function(){this.initialize()},this.activate=function(){return a.cancel(),this.drawControl?(this.drawControl.activate(),!0):!1},this.activateModify=function(){a.cancel(),a.editControl&&a.editControl.activate()},this.activateDelete=function(){a.drawControl.deactivate(),a.editControl.deactivate(),a.deleteControl&&a.deleteControl.activate()},this.save=function(){this.cancel();var a=this.saveStrategy.save();return this.refreshStrategy.refresh(),a},this.cancel=function(){a.drawControl.deactivate(),a.editControl.deactivate(),a.deleteControl.deactivate()},this.setMap=function(a){this.map=a,this.vectorLayer&&a.addLayer(this.vectorLayer)}},MuleGIS.Control.FeatureManager.prototype=new OpenLayers.Control,MuleGIS.Control.DeleteFeature=function(a,b){MuleGIS.Control.call(this),this.layer=a,this.clickFeature=function(a){void 0===a.fid?this.layer.destroyFeatures([a]):(a.state=OpenLayers.State.DELETE,this.layer.events.triggerEvent("afterfeaturemodified",{feature:a}),a.renderIntent="select",this.layer.drawFeature(a))},this.handler=new OpenLayers.Handler.Feature(this,a,{click:this.clickFeature}),this.setMap=function(a){this.map=a,this.handler&&this.handler.setMap(this.map)},this.setMap(b)},MuleGIS.Control.DeleteFeature.prototype=new OpenLayers.Control,MuleGIS.Control.LayerTree=function(){MuleGIS.Control.call(this);var a=this,b=!1,c=!1,d=new MuleGIS.Dictionary,e=0,f=0,g=null;this.baseGroupLabel="基础图层",this.normalGroupLabel="业务图层",this.draw=function(){var a=document.createElement("div");a.id=OpenLayers.Util.createUniqueID("layerTree_"),a.className="map-control panel panel-default",a.style.position="relative",a.style.top="0px",a.style.left="100px",a.style.zIndex="2001",a.style.width="400px";var b=document.createElement("div");b.className="panel-heading",a.appendChild(b);var c=document.createElement("span");c.className="panel-title layer-tree-title",c.innerText="图层管理",b.appendChild(c);var d=document.createElement("span");return d.className="ui-button-icon-primary ui-icon ui-icon-close layer-tree-close",d.id=OpenLayers.Util.createUniqueID("layer_tree_close_"),b.appendChild(d),g=document.createElement("div"),g.className="panel-body",a.appendChild(g),this.div=a,this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({click:this.onClick,mousedown:this.onMouseDown,mouseup:this.onMouseUp}),this.div.style.display="none",this.div},this.redraw=function(){for(var a=this.map.layers.slice(),b=g.children.item();b;)g.removeChild(b),b=g.children.item();document.createElement("div");var c=document.createElement("div");c.innerText=this.baseGroupLabel;var e=document.createElement("div");e.innerText=this.normalGroupLabel;for(var f=0,h=a.length;h>f;f++){var i=a[f],j=i.isBaseLayer;if(j){var k=document.createElement("div");k.className="layer-element";var l=document.createElement("input");l.id=OpenLayers.Util.createUniqueID("layer_check_"),l.type="radio",l.name="baseLayer",l.checked=i.visibility,l.className="layer-checkBox";var m=document.createElement("div");m.innerText=i.name,m.id=OpenLayers.Util.createUniqueID("layer_label_"),m.className="layer-label",d.put(l.id,i),k.appendChild(l),k.appendChild(m),c.appendChild(k)}else{var n=document.createElement("div");n.className="layer-element";var o=document.createElement("input");o.id=OpenLayers.Util.createUniqueID("layer_check_"),o.type="checkbox",o.checked=i.visibility,o.className="layer-checkBox";var p=document.createElement("div");p.id=OpenLayers.Util.createUniqueID("layer_label_"),p.innerText=i.name,p.className="layer-label",d.put(o.id,i),n.appendChild(o),n.appendChild(p),e.appendChild(n)}}g.appendChild(c),g.appendChild(e)},this.setMap=function(a){this.map=a,this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this})},this.onClick=function(){var a=event.srcElement;if(a)if("INPUT"===a.nodeName)switch(a.type){case"checkbox":var c=d.get(a.id);c.setVisibility(a.checked);break;case"radio":var e=d.get(a.id);this.map.setBaseLayer(e,!1)}else"SPAN"===a.nodeName&&0===a.id.indexOf("layer_tree_close_")&&(b=!1,this.div.style.display="none")},this.showControl=function(){b=!0,this.div.style.display=""},this.toggle=function(){b=!b,a.div.style.display=b?"":"none"},this.onMouseDown=function(){c=!0,this.events.on({mousemove:this.onMouseMove}),e=event.clientX,f=event.clientY},this.onMouseUp=function(){c=!1,this.events.un({mousemove:this.onMouseMove})},this.onMouseMove=function(){if(c){var a=event.clientX-e,b=event.clientY-f;e=event.clientX,f=event.clientY;var d=parseInt(this.div.style.top.replace("px",""),0),g=parseInt(this.div.style.left.replace("px",""),0);g+=a,d+=b,this.div.style.top=d+"px",this.div.style.left=g+"px"}}},MuleGIS.Control.LayerTree.prototype=new OpenLayers.Control,MuleGIS.Control.Location=function(){MuleGIS.Control.apply(this);for(var a,b,c,d=!1,e=!1,f=[],g=new OpenLayers.Layer.Markers("坐标定位图层"),h=OpenLayers.Events.prototype.BROWSER_EVENTS,i=0,j=h.length;j>i;i++)this[h[i]]&&this.unregister(h[i],this[h[i]]);this.draw=function(){var d=document.createElement("div");d.id="lonLatLocation",d.className="map-control panel panel-default",d.style.position="relative",d.style.top="0px",d.style.left="100px",d.style.zIndex="2001",d.style.width="220px";var e=document.createElement("div");e.className="panel-heading",d.appendChild(e);var f=document.createElement("span");f.className="panel-title layer-tree-title",f.innerText="坐标定位",e.appendChild(f);var g=document.createElement("span");g.className="ui-button-icon-primary ui-icon ui-icon-close layer-tree-close",g.id=OpenLayers.Util.createUniqueID("location_"),e.appendChild(g);var h=document.createElement("div");h.id="lonDiv",h.className="location-content";var i=document.createElement("span");i.innerText="经度:",i.style.margin="0px 5px",a=document.createElement("input"),a.type="text",a.tabIndex=1,h.appendChild(i),h.appendChild(a);var j=document.createElement("div"),k=document.createElement("span");j.className="location-content",k.innerText="纬度:",k.style.margin="0px 5px",b=document.createElement("input"),b.type="text",b.tabIndex=2,j.appendChild(k),j.appendChild(b);var l=document.createElement("div");return c=document.createElement("input"),c.type="button",c.className="location-button",c.value="定位",l.appendChild(c),c.id=OpenLayers.Util.createUniqueID("location_button_"),d.appendChild(e),d.appendChild(h),d.appendChild(j),d.appendChild(l),this.div=d,this.div.style.display="none",this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({click:this.onClick,mousedown:this.onMouseDown,mouseup:this.onMouseUp}),this.div},this.onZoomEnd=function(){for(var a=0;a<f.length;a++){var b=f[a].lonLat,c=f[a].div,d=this.map.getLayerPxFromLonLat(b);c.style.left=d.x-c.clientWidth/2+"px",c.style.top=d.y+"px"}},this.onClick=function(){var c=event.srcElement;if("SPAN"===c.nodeName&&0===c.id.indexOf("location_"))d=!1,this.div.style.display="none";else if("INPUT"===c.nodeName&&0===c.id.indexOf("location_button_")){var e=a.value,h=b.value,i=new OpenLayers.Size(19,29),j=new OpenLayers.Pixel(-(i.w/2),-i.h),k=new OpenLayers.Icon("img/red-marker.png",i,j),l=new OpenLayers.LonLat(e,h),m=document.createElement("div");m.className="marker-label",m.innerText=l.lon+","+l.lat;var n=l.transform(this.map.displayProjection,this.map.projection),o=new OpenLayers.Marker(n,k);g.addMarker(o);var p=this.map.getLayerPxFromLonLat(o.lonlat);m.style.position="absolute",g.div.appendChild(m),m.style.left=p.x-m.clientWidth/2+"px",m.style.top=p.y+"px",f.push({lonLat:o.lonlat,div:m}),this.map.panTo(n)}else c===a?a.select():c===b&&b.select()},this.setMap=function(a){this.map=a,this.map.addLayer(g),this.map.events.register("moveend",this,this.onZoomEnd)},this.toggle=function(){d=!d,this.div.style.display=d?"":"none"},this.onMouseDown=function(){e=!0,this.events.on({mousemove:this.onMouseMove}),dragX=event.clientX,dragY=event.clientY},this.onMouseUp=function(){e=!1,this.events.un({mousemove:this.onMouseMove})},this.onMouseMove=function(){if(e){var a=event.clientX-dragX,b=event.clientY-dragY;dragX=event.clientX,dragY=event.clientY;var c=parseInt(this.div.style.top.replace("px",""),0),d=parseInt(this.div.style.left.replace("px",""),0);d+=a,c+=b,this.div.style.top=c+"px",this.div.style.left=d+"px"}}},MuleGIS.Control.Measure=function(){MuleGIS.Control.call(this);var a=[],b=this,c={Point:{pointRadius:5,graphicName:"circle",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#FC7F43"},Line:{strokeWidth:2,strokeOpacity:1,strokeColor:"#FC7F43",strokeDashstyle:"solid"},Polygon:{strokeWidth:2,strokeLinecap:"round",strokeOpacity:1,strokeColor:"#FC7F43",fillColor:"white",fillOpacity:.3}},d=new OpenLayers.Style;d.addRules([new OpenLayers.Rule({symbolizer:c})]);var e=new OpenLayers.StyleMap({"default":d}),f=OpenLayers.Util.getParameters(window.location.href).renderer;f=f?[f]:OpenLayers.Layer.Vector.prototype.renderers,measureControls={line:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!0,handlerOptions:{layerOptions:{renderers:f,styleMap:e}}}),polygon:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{persist:!0,handlerOptions:{layerOptions:{renderers:f,styleMap:e}}})},this.setMap=function(a){this.map=a,measureControls.line.events.on({measure:this.handleMeasurements,measurepartial:this.handleAddPoint}),this.map.addControl(measureControls.line),measureControls.polygon.events.on({measure:this.handlePolygonMeasurements,measurepartial:this.handlePolygonAddPoint}),this.map.addControl(measureControls.polygon),this.map.events.register("moveend",this,this.onZoomEnd),this.map.events.register("move",this,this.onZoomEnd)},this.activeMeasureLine=function(){measureControls.polygon.deactivate(),measureControls.line.deactivate(),measureControls.line.activate()},this.activeMeasurePolygon=function(){measureControls.line.deactivate(),measureControls.polygon.deactivate(),measureControls.polygon.activate()},this.draw=function(){},this.onZoomEnd=function(){for(var c=0;c<a.length;c++)b.movePoint(a[c])},this.handleMeasurements=function(){var a=arguments[0],c=OpenLayers.Events.prototype.BROWSER_EVENTS,d=a.geometry.components[a.geometry.components.length-1];b.createPoint("line",d,a.measure,a.unit,!0);for(var e=0,f=c.length;f>e;e++)measureControls.polygon.handler[c[e]]&&measureControls.polygon.handler.unregister(c[e],measureControls.polygon.handler[c[e]]);for(e=0,f=c.length;f>e;e++)measureControls.line.handler[c[e]]&&measureControls.line.handler.unregister(c[e],measureControls.line.handler[c[e]])},this.handleAddPoint=function(){var a=arguments[0];if(a.geometry.components){var c=a.geometry.components[a.geometry.components.length-2];b.createPoint("line",c,a.measure,a.unit)}},this.handlePolygonMeasurements=function(){var c=arguments[0],d=OpenLayers.Events.prototype.BROWSER_EVENTS,e=c.geometry.components[0].components[c.geometry.components[0].components.length-2];b.createPoint("polygon",e,c.measure,c.unit);var f=c.geometry.getCentroid(),g=document.createElement("div");g.className="measure-label",g.style.position="absolute";var h=document.createElement("span");g.appendChild(h),h.innerText=c.measure.toFixed(2),h.innerText+="m"===c.unit?"平方米":"平方公里",a.push({lonLat:new OpenLayers.LonLat(f.x,f.y),div:g,lDiv:null}),measureControls.polygon.handler.layer.div.appendChild(g),b.movePoint(a[a.length-1]);for(var i=0,j=d.length;j>i;i++)measureControls.polygon.handler[d[i]]&&measureControls.polygon.handler.unregister(d[i],measureControls.polygon.handler[d[i]]);for(i=0,j=d.length;j>i;i++)measureControls.line.handler[d[i]]&&measureControls.line.handler.unregister(d[i],measureControls.line.handler[d[i]])},this.handlePolygonAddPoint=function(){var a=arguments[0];if(a.geometry.components){var c=a.geometry.components[0].components[a.geometry.components[0].components.length-2];b.createPoint("polygon",c,a.measure,a.unit)}},this.createPoint=function(b,c,d,e,f){var g=new OpenLayers.LonLat(c.x,c.y);this.map.getLayerPxFromLonLat(g);var h=document.createElement("div");h.className="measure-point",h.style.position="absolute";var i=document.createElement("div");if("line"===b){i.className="measure-label",i.style.position="absolute";var j=document.createElement("span");i.appendChild(j),0===d?j.innerText="起点":(j.innerText=d.toFixed(2),j.innerText+="m"===e?"米":"公里",f&&(j.innerText="总计"+j.innerText))}a.push({lonLat:g,div:h,lDiv:i}),measureControls.polygon.active?(measureControls.polygon.handler.layer.div.appendChild(h),measureControls.polygon.handler.layer.div.appendChild(i)):(measureControls.line.handler.layer.div.appendChild(h),measureControls.line.handler.layer.div.appendChild(i)),this.movePoint(a[a.length-1])},this.movePoint=function(a){var c=a.div,d=a.lDiv,e=b.map.getLayerPxFromLonLat(a.lonLat),f=c.parentNode.style.left.replace("px",""),g=c.parentNode.style.top.replace("px",""),h=e.x-5.5-f,i=e.y-5.5-g;c.style.left=h+"px",c.style.top=i+"px",d&&(d.style.left=h+8+"px",d.style.top=i+8+"px")},this.clear=function(){measureControls.polygon.deactivate(),measureControls.line.deactivate()}},MuleGIS.Control.MousePosition=function(){MuleGIS.Control.call(this),this.option=arguments[0],this.numDigits=3,"undefined"!=this.option&&this.option&&OpenLayers.Util.extend(MuleGIS.Control.MousePosition.prototype,this.option),MuleGIS.Control.MousePosition.prototype.numDigits=this.numDigits;var a=function(a){var b=parseInt(this.numDigits,null),c="经度:"+a.lon.toFixed(b)+" 纬度:"+a.lat.toFixed(b)+this.suffix;return c};MuleGIS.Control.MousePosition.prototype.formatOutput=a},MuleGIS.Control.MousePosition.prototype=new OpenLayers.Control.MousePosition,MuleGIS.Control.Navigation=function(){MuleGIS.Control.call(this),isCallOlNavigation=!1,isSliderButtonMouseDown=!1,sliderButtonY=0,this.slideFactor=50,this.position=new OpenLayers.Pixel(2,10),this.slideRatio=.2,this.mouseDown=!1;var a=this,b=null,c=null,d=null,e=null;this.navigationHistory=new OpenLayers.Control.NavigationHistory,this.setMap=function(b){OpenLayers.Control.prototype.setMap.apply(this,arguments),a.navigationHistory.setMap(b),this.map.events.register("buttonclick",this,this.onButtonClick),this.map.events.register("moveend",this,this.onZoomEnd)},this.onButtonClick=function(b){var c=b.buttonElement;switch(c.action){case"PanNorth":this.map.pan(0,-this.getSlideFactor("h"));break;case"PanSouth":this.map.pan(0,this.getSlideFactor("h"));break;case"PanWest":this.map.pan(-this.getSlideFactor("w"),0);break;case"PanEast":this.map.pan(this.getSlideFactor("w"),0);break;case"Zoomin":this.map.zoomIn();break;case"Zoomout":this.map.zoomOut();break;case"FullExtend":this.map.zoomToMaxExtent();break;case"PanPrevious":a.navigationHistory.previousTrigger();break;case"PanNext":a.navigationHistory.nextTrigger()}},this.draw=function(){OpenLayers.Control.prototype.draw.apply(this.arguments),isCallOlNavigation||(OpenLayers.Control.Navigation.prototype.draw.call(this),isCallOlNavigation=!0),a.navigationHistory.draw(),this.div=document.createElement("div"),this.div.className="map-control";var b=createDirection(),c=createHistory(),d=this.createSlider();return this.div.appendChild(b),this.div.appendChild(c),this.div.appendChild(d),a.setSliderLevel(),a.navigationHistory.activate(),this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({touchstart:this.onMouseDown,touchmove:this.onMouseMove,touchend:this.onMouseUp,mousedown:this.onMouseDown,mousemove:this.x,mouseup:this.onMouseUp}),this.div.style.position="absolute",this.div.style.top=this.position.x+"px",this.div.style.left=this.position.y+"px",this.rectify(),this.div},this.rectify=function(){},createDirection=function(){var a=document.createElement("div");a.className="map-pan";var b=document.createElement("div");b.id="btnPanNorth",b.action="PanNorth",b.className="olButton map-button map-panN",b.title="向上平移",$(b).panButton(1),a.appendChild(b);var c=document.createElement("div");c.id="btnPanWest",c.action="PanWest",c.className="olButton map-button map-panW",$(c).panButton(4),c.title="向左平移",a.appendChild(c);var d=document.createElement("div");d.id="btnPanEast",d.title="向右平移",d.action="PanEast",d.className="olButton map-button map-panE",$(d).panButton(2),a.appendChild(d);var e=document.createElement("div");return e.id="btnPanSouth",e.title="向下平移",e.action="PanSouth",e.className="olButton map-button map-panS",$(e).panButton(3),a.appendChild(e),a},createHistory=function(){var a=document.createElement("div");a.id="mapHistoryElement",a.className="map-history";var b=document.createElement("div");b.id="btnPrevious",b.title="前一视图",b.action="PanPrevious",b.className="olButton map-previous",a.appendChild(b);var c=document.createElement("div");c.id="btnFullExtend",c.title="全屏",c.action="FullExtend",c.className="olButton map-fullExtend",a.appendChild(c);var d=document.createElement("div");return d.id="btnPrevious",d.title="后一视图",d.action="PanNext",d.className="olButton map-next",a.appendChild(d),a},this.createSlider=function(){var e=document.createElement("div");e.id="mapSlider",e.className="map-slider";var f=document.createElement("div");f.id="btnZoominLevel",f.title="放大一级",f.className="olButton map-zoominLevelButton",f.action="Zoomin",e.appendChild(f),b=document.createElement("div"),b.id="sliderBar",b.className="map-sliderBar",c=document.createElement("div"),c.id="btnSlider",c.title="拖动缩放",c.className="olButton map-sliderButton",c.map=this.map,c.onmousedown=function(){a.mouseDown=!0,a.events.on({mouseup:a.onMouseUp,mousemove:a.onMouseMove}),a.map.events.on({mouseup:a.onMouseUp,mousemove:a.onMouseMove}),sliderButtonY=event.clientY},c.onmouseup=a.onMouseUp,b.appendChild(c);var g=document.createElement("div");g.id="sliderBarTop",g.className="map-sliderBarTop",b.appendChild(g),d=document.createElement("div"),d.id="sliderBarBot",d.className="map-sliderBarBot",b.appendChild(d),e.appendChild(b);var h=document.createElement("div");return h.id="btnZoomoutLevel",h.title="缩小一级",h.className="olButton map-zoomoutLevelButton",h.action="Zoomout",e.appendChild(h),$(document).bind("mouseup",this.onMouseUp),e},this.onMouseUp=function(){if(a.mouseDown===!0){a.mouseDown=!1,a.events.un({mouseup:a.onMouseUp,mousemove:a.onMouseMove}),a.map.events.un({mouseup:a.onMouseUp,mousemove:a.onMouseMove});var b=event.clientY,c=sliderButtonY-b,d=$("#btnSlider").css("top").replace("px","");$("#sliderBar").height();var e=d-c-1;e=e+1-e%6;var f=(e-1)/6;a.map.zoomTo(a.map.numZoomLevels-f-1)}},this.onMouseMove=function(){if(a.mouseDown===!0){var b=event.clientY,c=sliderButtonY-b;sliderButtonY=b;var d=$("#btnSlider").css("top").replace("px",""),e=$("#sliderBar").height(),f=d-c;f>e-11?f=e-11:1>f&&(f=1),$("#btnSlider").css("top",f+"px"),a.setSliderBarBotStyle(f)}},this.getSlideFactor=function(a){return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor},this.setSliderLevel=function(){var c=a.map.numZoomLevels;e=12+6*(c-1),$(b).css("height",e+"px"),this.onZoomEnd()},this.onZoomEnd=function(){var b=a.map.getZoom(),d=a.map.numZoomLevels,e=6*(d-b-1)+1;$(c).css("top",e+"px"),this.setSliderBarBotStyle(e)},this.setSliderBarBotStyle=function(b){a.map.getZoom(),a.map.numZoomLevels,$(d).css("top",b+"px"),$(d).css("height",e-b+4+"px")}},MuleGIS.Control.Navigation.prototype=new OpenLayers.Control.Navigation,MuleGIS.Control.Navigation.prototype.defaultClick=function(a){MuleGIS.Util.isLayerDivChild(a.srcElement)===!0&&a.lastTouches&&2==a.lastTouches.length&&this.map.zoomOut()},MuleGIS.Control.Navigation.prototype.defaultDblClick=function(a){MuleGIS.Util.isLayerDivChild(a.srcElement)===!0&&this.map.zoomTo(this.map.zoom+1,a.xy)},MuleGIS.Control.Navigation.prototype.defaultDblRightClick=function(a){MuleGIS.Util.isLayerDivChild(a.srcElement)===!0&&this.map.zoomTo(this.map.zoom-1,a.xy)},MuleGIS.Control.Navigation.prototype.wheelChange=function(a,b){if(MuleGIS.Util.isLayerDivChild(a.srcElement)===!0){this.map.fractionalZoom||(b=Math.round(b));var c=this.map.getZoom(),d=c+b;if(d=Math.max(d,0),d=Math.min(d,this.map.getNumZoomLevels()),d===c)return;this.map.zoomTo(d,a.xy)}},MuleGIS.Control.Navigation.prototype.wheelUp=function(a,b){MuleGIS.Util.isLayerDivChild(a.srcElement)===!0&&this.wheelChange(a,b||1)},MuleGIS.Control.Navigation.prototype.wheelDown=function(a,b){MuleGIS.Util.isLayerDivChild(a.srcElement)===!0&&this.wheelChange(a,b||-1)},jQuery.fn.panButton=function(a){this.mouseover(function(){$(this).parent().css("backgroundPosition"," 0px -"+44*a+"px")}),this.mouseout(function(){$(this).parent().css("backgroundPosition"," 0px 0px")})},MuleGIS.Control.Overview=function(){MuleGIS.Control.call(this),this.option=arguments[0],"undefined"!=this.option&&this.option&&OpenLayers.Util.extend(MuleGIS.Control.Overview.prototype,this.option),this.width=160,this.height=160},MuleGIS.Control.Overview.prototype=new OpenLayers.Control.OverviewMap,MuleGIS.Control.Overview.prototype.draw=function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),0===this.layers.length){if(!this.map.baseLayer)return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;var a=this.map.baseLayer.clone();this.layers=[a]}if(this.element=document.createElement("div"),this.element.className="map-control",this.element.style.display="none",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.width+"px",this.mapDiv.style.height=this.height+"px",this.mapDiv.style.position="relative",this.mapDiv.style.overflow="hidden",this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap"),this.extentRectangle=document.createElement("div"),this.extentRectangle.style.position="absolute",this.extentRectangle.style.zIndex=1e3,this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.element.appendChild(this.mapDiv),this.div.appendChild(this.element),this.outsideViewport)this.element.style.display="";else{this.div.className+=" map-control "+this.displayClass+"Container";var b=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,b,"absolute"),this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton",this.maximizeTitle&&(this.maximizeDiv.title=this.maximizeTitle),this.div.appendChild(this.maximizeDiv),b=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png"),this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,b,"absolute"),this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton",this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle),this.div.appendChild(this.minimizeDiv),this.minimizeControl()}return this.map.getExtent()&&this.update(),this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this}),this.maximized&&this.maximizeControl(),this.div},MuleGIS.Control.Print=function(){MuleGIS.Control.call(this);var a=this;this.title="标题",this.subTitle="副标题",this.mapWidth=640,this.draw=function(){},this.print=function(){var b=window.open("print.html");b.document.body.onload=function(){var c=b.document.getElementById("map"),d=new MuleGIS.Initilize;a.map.getExtent();var e=d.options,f=new OpenLayers.Map(c,e);f.addLayers(d.layers),f.addControls(d.controls),c.className="map olmap",f.setCenter(a.map.center,a.map.zoom)}},this.display=function(a){this.div.style.display=a?"":"none"}},MuleGIS.Control.Print.prototype=new OpenLayers.Control,MuleGIS.Control.Query=function(){MuleGIS.Control.call(this);var a=this;this.properName="NAME99",this.typeName="china:liaoning",this.url="http://localhost:8080/geoserver/wfs?",this.isLike=!0,this.value="沈阳",this.callback=null,handlerReponse=function(b){var c=new OpenLayers.Format.GML,d=c.read(b.responseText);null!==a.callback&&"function"==typeof a.callback&&a.callback(d),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},this.draw=function(){},this.query=function(){OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");var a="<?xml version='1.0' encoding='UTF-8'?><wfs:GetFeature  service='WFS' version='1.0.0' xmlns:wfs='http://www.opengis.net/wfs' xmlns:gml='http://www.opengis.net/gml' xmlns:ogc='http://www.opengis.net/ogc' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation='http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd'><wfs:Query typeName='"+this.typeName+"'>";a+=this.isLike===!0?"<ogc:Filter><ogc:PropertyIsLike wildCard='*' singleChar='.' escape='!'><ogc:PropertyName>"+this.properName+"</ogc:PropertyName>"+"<ogc:Literal>*"+this.value+"*</ogc:Literal>"+"</ogc:PropertyIsLike>"+"</ogc:Filter>":"<ogc:Filter><ogc:PropertyIsEqualTo><ogc:PropertyName>"+this.properName+"</ogc:PropertyName>"+"<ogc:Literal>"+this.value+"</ogc:Literal>"+"</ogc:PropertyIsEqualTo>"+"</ogc:Filter>",a+="</wfs:Query></wfs:GetFeature>";
var b=OpenLayers.Request.POST({url:this.url,outputFormat:"JSON",callback:handlerReponse});b.send(a)}},MuleGIS.Control.ScaleLine=function(){MuleGIS.Control.call(this),this.topOutUnitsLabel="公里",this.topInUnitsLabel="米"},MuleGIS.Control.ScaleLine.prototype=new OpenLayers.Control.ScaleLine,MuleGIS.Control.ScaleLine.prototype.eLeft=null,MuleGIS.Control.ScaleLine.prototype.eRight=null,MuleGIS.Control.ScaleLine.prototype.draw=function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.eTop||(this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top",this.topInUnits.length,this.div.appendChild(this.eTop),this.eTop.style.visibility=""===this.topOutUnits||""===this.topInUnits?"hidden":"visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),this.eBottom.style.visibility=""===this.bottomOutUnits||""===this.bottomInUnits?"hidden":"visible",this.eLeft=document.createElement("div"),this.eLeft.className=this.displayClass+"Left",this.div.appendChild(this.eLeft),this.eRight=document.createElement("div"),this.eRight.className=this.displayClass+"Right",this.div.appendChild(this.eRight)),this.map.events.register("moveend",this,this.update),this.update(),this.div},MuleGIS.Control.ScaleLine.prototype.update=function(){var a=this.map.getResolution();if(a){var b=this.map.getUnits(),c=OpenLayers.INCHES_PER_UNIT,d=this.maxWidth*a*c[b],e=1;if(this.geodesic===!0){var f=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth,g=d/c.km;e=f/g,d*=e}var h,i,j;d>1e5?(h=this.topOutUnits,i=this.topOutUnitsLabel,j=this.bottomOutUnits):(h=this.topInUnits,i=this.topInUnitsLabel,j=this.bottomInUnits);var k=d/c[h],l=d/c[j],m=this.getBarLen(k),n=this.getBarLen(l);k=m/c[b]*c[h],l=n/c[b]*c[j];var o=k/a/e,p=l/a/e;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(p)+"px",this.eBottom.innerHTML=n+" "+j),"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(o)+"px",this.eTop.innerHTML=m+" "+i)}},MuleGIS.Dictionary=function(){this.elements=[],this.size=function(){return this.elements.length},this.isEmpty=function(){return this.elements.length<1},this.clear=function(){this.elements=[]},this.put=function(a,b){this.elements.push({key:a,value:b})},this.removeByKey=function(a){var b=!1;try{for(i=0;i<this.elements.length;i++)if(this.elements[i].key==a)return this.elements.splice(i,1),!0}catch(c){b=!1}return b},this.removeByValue=function(a){var b=!1;try{for(i=0;i<this.elements.length;i++)if(this.elements[i].value==a)return this.elements.splice(i,1),!0}catch(c){b=!1}return b},this.removeByValueAndKey=function(a,b){var c=!1;try{for(i=0;i<this.elements.length;i++)if(this.elements[i].value==b&&this.elements[i].key==a)return this.elements.splice(i,1),!0}catch(d){c=!1}return c},this.get=function(a){try{for(i=0;i<this.elements.length;i++)if(this.elements[i].key==a)return this.elements[i].value}catch(b){return!1}return!1},this.element=function(a){return 0>a||a>=this.elements.length?null:this.elements[a]},this.containsKey=function(a){var b=!1;try{for(i=0;i<this.elements.length;i++)this.elements[i].key==a&&(b=!0)}catch(c){b=!1}return b},this.containsValue=function(a){var b=!1;try{for(i=0;i<this.elements.length;i++)this.elements[i].value==a&&(b=!0)}catch(c){b=!1}return b},this.containsObj=function(a,b){var c=!1;try{for(i=0;i<this.elements.length;i++)this.elements[i].value==b&&this.elements[i].key==a&&(c=!0)}catch(d){c=!1}return c},this.values=function(){var a=[];for(i=0;i<this.elements.length;i++)a.push(this.elements[i].value);return a},this.valuesByKey=function(a){var b=[];for(i=0;i<this.elements.length;i++)this.elements[i].key==a&&b.push(this.elements[i].value);return b},this.keys=function(){var a=[];for(i=0;i<this.elements.length;i++)a.push(this.elements[i].key);return a},this.keysByValue=function(a){var b=[];for(i=0;i<this.elements.length;i++)a==this.elements[i].value&&b.push(this.elements[i].key);return b},this.keysRemoveDuplicate=function(){var a=[];for(i=0;i<this.elements.length;i++){for(var b=!0,c=0;c<a.length;c++)if(a[c]==this.elements[i].key){b=!1;break}b&&a.push(this.elements[i].key)}return a}},MuleGIS.Handler=function(){},MuleGIS.Handler.Drag=function(){if(3===arguments.length){var a=new OpenLayers.Handler.Drag(arguments[0],arguments[1],arguments[2]);return MuleGIS.Handler.Drag.prototype=a,MuleGIS.Handler.Drag.prototype.mousedown=function(a){return MuleGIS.Util.isLayerDivChild(a.srcElement)===!0?this.down(a):void 0},new MuleGIS.Handler.Drag(arguments[0],arguments[1],arguments[2],null)}},MuleGIS.Handler.Path=function(){if(3===arguments.length){var a=new OpenLayers.Handler.Path(arguments[0],arguments[1],arguments[2]);return MuleGIS.Handler.Path.prototype=a,MuleGIS.Handler.Path.prototype.mousedown=function(a){return MuleGIS.Util.isLayerDivChild(a.srcElement)===!0?this.down(a):void 0},new MuleGIS.Handler.Path(arguments[0],arguments[1],arguments[2],null)}},MuleGIS.Handler.Point=function(){if(3===arguments.length){var a=new OpenLayers.Handler.Point(arguments[0],arguments[1],arguments[2]);return MuleGIS.Handler.Point.prototype=a,MuleGIS.Handler.Point.prototype.mousedown=function(a){return MuleGIS.Util.isLayerDivChild(a.srcElement)===!0?this.down(a):void 0},new MuleGIS.Handler.Point(arguments[0],arguments[1],arguments[2],null)}},MuleGIS.Handler.Polygon=function(){if(3===arguments.length){var a=new OpenLayers.Handler.Polygon(arguments[0],arguments[1],arguments[2]);return MuleGIS.Handler.Polygon.prototype=a,MuleGIS.Handler.Polygon.prototype.mousedown=function(a){return MuleGIS.Util.isLayerDivChild(a.srcElement)===!0?this.down(a):void 0},new MuleGIS.Handler.Polygon(arguments[0],arguments[1],arguments[2],null)}},MuleGIS.Initilize=function(){function a(a){var b=new OpenLayers.Format.SLD;b.read(a.responseXML||a.responseText)}var b="image/png";this.bounds=new OpenLayers.Bounds(119.757,40.368,127.156,42.757),this.options={controls:[],maxExtent:this.bounds,projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),units:"degrees"},this.layers=[],this.controls=[],new OpenLayers.Layer.WMS("本地底图","http://192.168.196.189:8080/geoserver/china/wms",{LAYERS:"china",STYLES:"",format:b,tiled:!0,tilesOrigin:this.bounds.left+","+this.bounds.bottom},{buffer:0,displayOutsideMaxExtent:!0,isBaseLayer:!0,yx:{"EPSG:4326":!0}}),new OpenLayers.Layer.WMS("辽宁省","http://localhost:8080/geoserver/china/wms",{LAYERS:"china:liaoning_postgre",STYLES:"",format:b,tiled:!0,transparent:"true",tilesOrigin:this.bounds.left+","+this.bounds.bottom},{buffer:0,displayOutsideMaxExtent:!0,isBaseLayer:!1,yx:{"EPSG:4326":!0}});var c=new OpenLayers.Layer.WMS("北京","http://192.168.196.189:8080/geoserver/china/wms",{LAYERS:"china:beijing",STYLES:"",format:b,tiled:!0,transparent:"true",tilesOrigin:this.bounds.left+","+this.bounds.bottom},{buffer:0,displayOutsideMaxExtent:!0,isBaseLayer:!1,yx:{"EPSG:4326":!0}}),d=OpenLayers.Util.getParameters(window.location.href).renderer;d=d?[d]:OpenLayers.Layer.Vector.prototype.renderers,this.vectorLayer=new OpenLayers.Layer.Vector("辽宁",{projection:new OpenLayers.Projection("EPSG:4326"),strategies:[new OpenLayers.Strategy.Fixed,new OpenLayers.Strategy.Save({auto:!0}),new OpenLayers.Strategy.Refresh],protocol:new OpenLayers.Protocol.WFS({url:"http://192.168.196.189:8080/geoserver/wfs",version:"1.0.0",featurePrefix:"china",featureType:"liaoning",featureNS:"http://www.neusoft.com/china",srsName:"EPSG:4326",isBaseLayer:!1,geometryType:"OpenLayers.Geometry.Polygon",geometryName:"geom"}),renderers:d});var e=new OpenLayers.Layer.Google("谷歌底图",{sphericalMercator:!0});this.layers.push(e),this.layers.push(c),this.layers.push(this.vectorLayer),this.layerTree=new MuleGIS.Control.LayerTree;var f=new MuleGIS.Control.MousePosition({element:$("#location").get(0)}),g=new MuleGIS.Control.Overview({maximizeTitle:"展开鹰眼图",minimizeTitle:"折叠鹰眼图"}),h=new MuleGIS.Control.Navigation({position:new OpenLayers.Pixel(2,15)});h.pinchZoom=!1,this.printControl=new MuleGIS.Control.Print,this.lonlatLocation=new MuleGIS.Control.Location,this.measureControl=new MuleGIS.Control.Measure,this.queryControl=new MuleGIS.Control.Query,this.drawFeatureControl=new MuleGIS.Control.DrawFeature,this.controls.push(this.layerTree),this.controls.push(g),this.featureManager=new MuleGIS.Control.FeatureManager,this.featureManager.url="http://localhost:8080/geoserver/wfs",this.featureManager.srsName="EPSG:4326",this.featureManager.featureNS="http://www.neusoft.com/china",this.featureManager.featurePrefix="china",this.featureManager.featureType="house",this.featureManager.geometryName="geom",this.featureManager.layerName="编辑图层",this.featureManager.autoSave=!1,this.controls.push(this.featureManager),this.controls.push(h),this.controls.push(new MuleGIS.Control.ScaleLine),this.controls.push(f),this.controls.push(this.lonlatLocation),this.controls.push(this.printControl),this.controls.push(this.queryControl),this.controls.push(this.measureControl),this.controls.push(this.drawFeatureControl),this.drawFeatureControl.setFeatureAdded(function(a){var b=new OpenLayers.Format.GeoJSON,c=b.write(a);alert("图形序列化信息:\r\b"+c)}),OpenLayers.Request.GET({url:"http://localhost:8080/geoserver/styles/liaoning.sld",success:a})},MuleGIS.Label=function(){this.label="",this.offset=null,this.div=null,this.px=null,this.initialize=function(a,b){this.label=a,this.offset=b||{x:0,y:0};var c=OpenLayers.Util.createUniqueID("MuleGIS_Lable_");this.div=OpenLayers.Util.createDiv(c);var d=document.createElement("a");d.innerText=a,this.div.appendChild(d)},this.initialize(arguments[0],arguments[1]),this.destroy=function(){this.erase(),OpenLayers.Event.stopObservingElement(this.div.firstChild),this.div.innerHTML="",this.div=null},this.clone=function(){return new MuleGIS.Lable(this.label,this.offset)},this.draw=function(a){return OpenLayers.Util.modifyAlphaImageDiv(this.div,null,null,null,null,"absolute"),this.moveTo(a),this.div},this.erase=function(){null!==this.div&&null!==this.div.parentNode&&OpenLayers.Element.remove(this.div)},this.moveTo=function(a){null!==a&&(this.px=a),null!==this.div&&(null===this.px?this.display(!1):OpenLayers.Util.modifyAlphaImageDiv(this.div,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y}))},this.display=function(a){this.div.style.display=a?"":"none"},this.isDrawn=function(){var a=this.div&&this.div.parentNode&&11!=this.div.parentNode.nodeType;return a}},MuleGIS.LabelMarker=function(){this.label=null,this.lonlat=null,this.events=null,this.map=null,this.initialize=function(a,b){this.lonlat=a;var c=b?b:new MuleGIS.Label;this.label=null===this.label?c:b,this.events=new OpenLayers.Events(this,this.label.div)},this.initialize(arguments[0],arguments[1]),this.destroy=function(){this.erase(),this.map=null,this.events.destroy(),this.events=null,null!==this.label&&(this.label.destroy(),this.label=null)},this.draw=function(a){return this.label.draw(a)},this.erase=function(){null!==this.label&&this.label.erase()},this.moveTo=function(a){null!==a&&null!==this.label&&this.label.moveTo(a),this.lonlat=this.map.getLonLatFromLayerPx(a)},this.isDrawn=function(){var a=this.label&&this.label.isDrawn();return a},this.onScreen=function(){var a=!1;if(this.map){var b=this.map.getExtent();a=b.containsLonLat(this.lonlat)}return a},this.inflate=function(a){this.label&&this.label.setSize({w:this.icon.size.w*a,h:this.icon.size.h*a})},this.display=function(a){this.label.display(a)}},MuleGIS.Map=function(){},MuleGIS.Map.prototype=new OpenLayers.Map,MuleGIS.Util={isLayerDivChild:function(a){return a.id.indexOf("OpenLayers_Container")>0?!0:a.parentElement?MuleGIS.Util.isLayerDivChild(a.parentElement):!1}};