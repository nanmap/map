<!DOCTYPE html>
<html>
<head>
<title>MuleGIS for Javascript Sample</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="css/bootstrap.css" rel="stylesheet" media="screen">
<link href="css/font-awesome.css" rel="stylesheet">
<link href="css/jquery-ui-bootstrap.css" rel="stylesheet">
<style style="text/css">
a {
	cursor: pointer;
	font-weight: lighter;
}

body {
	margin: 0px;
	padding: 0px;
	background-color: #CCC;
}

#container, 
#topbar, 
#floating-toolbar {
	-moz-user-select: none;
	-webkit-user-select: none;
	-ms-user-select: none;
	z-index: 2000;
}

.groupBtn {
	border: 1px solid #ccc;
}

.layer-element {
	padding: 5px 15px;
}

.layer-checkBox {
	float: left;
	padding: 5px 15px;
}

.layer-tree-title {
	
}

.layer-tree-close {
	position: absolute;
	right: 6px;
	top: 5px;
}

#location {
	margin: 0px;
	padding: 0px;
	left: 10px;
	width: 50%;
	position: absolute;
	bottom: 5px;
	z-index: 101;
	color: #000000;
	font-Family: 宋体;
	font-Size: 12px;
}

#map {
	margin: 0px;
	padding: 0px;
	position: relative;
	z-index: 0;
	border: 0px solid black;
	background-color: rgb(127,127,127);
}

.map-pan {
	width: 44px; 
	background: url("img/mapctrls20.png") no-repeat; 
	height: 44px; 
	overflow: hidden;
	z-index: 1001;
	left: 16px;
	position: relative;
	top: 10px;
}

.map-button {
	height: 15px;
	width: 15px;
	position: absolute;
}

.map-fullExtend {
	position: relative;
	top: -18px;
	left: 20px;
	background: url("img/zoom-world-mini.png") no-repeat;
	background-position: 0px 0px;
	z-index: 1001;
	width: 18px;
	height: 18px;
}

.map-history {
	top: 10px;
	left: 10px;
	position: relative;
	z-index: 1010;
}

.map-next {
	position: relative;
	top: -36px;
	left: 40px;
	background: url("img/east-mini.png") no-repeat;
	background-position: 0px 0px;
	z-index: 1001;
	width: 18px;
	height: 18px;
}

.map-panN,
.map-panW,
.map-panE,
.map-panS {
	overflow: hidden;
	cursor: pointer;
}

.map-panE {
	top: 12px; 
	left: 27px;
}

.map-panN {
	top: 0px; 
	left: 14px;
}

.map-panS {
	top: 25px; 
	left: 14px;
}

.map-panW {
	top: 12px;
	left: 1px;
}

.map-previous {
	background: url("img/west-mini.png") no-repeat;
	width: 18px;
	height: 18px;
	background-position: 0px 0px;
	position: relative;
	z-index: 1005;
	cursor: pointer;
}

.map-slider {
	position: relative;
	top: -24px;
	left: 28px;
	z-index: 1010;
}

.map-sliderBarTop {
	position: relative;
	top: 0px;
	float: left;
	left: -14px;
	width: 9px;
	background: url("img/mapctrls20.png") no-repeat;
	background-position: -23px -226px;
	overflow: hidden;
	z-index: 1001;
	height: 100%;
}

.map-sliderBarBot {
	position: relative;
	left: -23px;
	width: 9px;
	background: url("img/mapctrls20.png") no-repeat;
	background-position: -32px bottom;
	height: 100%;
	z-index: 1001;
	overflow: hidden;
}

.map-sliderButton {
	cursor: url("img/openhand.cur"),default;
	position: relative;
	float: left;
	top: 1px;
	left: 1px;
	width: 20px;
	background: url("img/mapctrls20.png") no-repeat;
	background-position: 0px -309px;
	height: 11px;
	z-index: 1002;
}

.map-sliderButton:active {
	cursor: url("img/closedhand.cur"),default;
}

.map-zoominLevelButton {
	position: relative;
	top: 3px;
	left: 0px;
	background: url("img/mapctrls20.png") no-repeat;
	background-position: 0px -221px;
	z-index: 1002;
	width: 22px;
	height: 21px;
}

.map-zoominLevelButton:hover {
	background: url("img/mapctrls20.png") no-repeat;
	background-position: 0px -243px;
}

.map-zoomoutLevelButton {
	position: relative;
	top: 0px;
	left: 0px;
	background: url("img/mapctrls20.png") no-repeat;
	background-position: 0px -265px;
	z-index: 1002;
	width: 22px;
	height: 21px;
}

.map-zoomoutLevelButton:hover {
	background: url("img/mapctrls20.png") no-repeat;
	background-position: 0px -287px;
}
#title {
	margin: 0px;
	padding: 0px;
	position: relative;
	z-index: 100;
	color: yellow;
	background-color: #333333;
	height: 40px;
}
</style>
</head>
<body style="font-size: 14px;line-height:20px;">
	<div id="headDiv" class="navbar navbar-default navbar-fixed-top navbar-inner" role="navigation" style="height: 40px">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
			  <span class="sr-only">Toggle navigation</span>
			  <span class="icon-bar"></span>
			  <span class="icon-bar"></span>
			  <span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" >电子政务开发部 WebGIS for Javascript 平台</a>
		</div>
		<div class="collapse navbar-collapse">
			<ul class="nav navbar-nav" >
				<li>
					<a>关于</a>
				</li>
				<li>
					<a id="layer-manage" data-toggle="collapse" data-target="#layerTree">图层管理</a>
				</li>
				<li class = "dropdown">
					<a class = "dropdown-toggle" data-toggle="dropdown">API<b class="caret"></b></a>
					<ul class = "dropdown-menu">
						<li> <a>多边形</a> </li>
						<li> <a>线</a> </li>
						<li> <a>点</a> </li>
					</ul>
				</li>
				<form class="navbar-form navbar-left" id="search-form">
					<div class="form-group">
						<input class="form-control" id="q" name="q" placeholder="查询" type="text">
					</div>
					<button class="btn btn-default btn-search" type="submit" title="Search"><i class="icon-search"></i></button>
				</form>
			</ul>
		</div>
	</div>
	<div align="center" style="position:absolute;top: 40px;width: 100%;padding: 0px;margin: 0px;">
		<div id="map" >
		</div>
	</div>
	<div id="save" style="position:absolute;left:20px;bottom:50px;"><input type="button" id ="inputButton" value="保存"></input></div>
	<div id="location"> </div>
    <script src="lib/jquery.min.js"></script>
    <script src="lib/bootstrap.min.js"></script>
	<script src="lib/jquery-ui-bootstrap.min.js"></script>
	<script src="lib/openlayers.debug.js"></script>
	<script src="lib/MuleGIS.debug.js"></script>
	<script defer="defer" type="text/javascript">
		OpenLayers.ProxyHost = "cgi/proxy.cgi?url=";
		var vectorLayer = null;
		var saveStrategy = null;
		var layerTree = null;
		$.fn.setHeight = function (control) {
			var $w = $(window);
			$title = control;
			$this = $(this);
			var init = function () {
				var wH = $w.height(),
				wW = $w.width(),
				tW = $title.width(),
				tH = $title.height();
				$this.css({height:(wH - tH - 3) + 'px'});
			};

			init();
			$w.resize(init);
		};
		var initMap = function () {
			var map;
			var format;
			var bounds = new OpenLayers.Bounds(
				73.44695116999999, 6.318855145999999,
				135.0857977, 53.55788027
			);

			var options = {
				controls: [],
				maxExtent: bounds,
				projection: "EPSG:4326",
				units: 'degrees'
			};

			map = new OpenLayers.Map('map',options);
			format = 'image/png';
			tiled = new OpenLayers.Layer.WMS(
				"底图", "http://192.168.196.189:8080/geoserver/china/wms",
				{
					LAYERS: 'china',
					STYLES: '',
					format: format,
					tiled: true,
					tilesOrigin : map.maxExtent.left + ',' + map.maxExtent.bottom
				},
				{
					buffer: 0,
					displayOutsideMaxExtent: true,
					isBaseLayer: true,
					yx : {'EPSG:4326' : true}
				}
			);
			var liaoning = new OpenLayers.Layer.WMS(
				"辽宁省", "http://localhost:8080/geoserver/china/wms",
				{
					LAYERS: 'china:liaoning',
					STYLES: '',
					format: format,
					tiled: true,
					transparent: "true",
					tilesOrigin : map.maxExtent.left + ',' + map.maxExtent.bottom
				},
				{
					buffer: 0,
					displayOutsideMaxExtent: true,
					isBaseLayer: false,
					yx : {'EPSG:4326' : true}
				}
			);
			var beijing = new OpenLayers.Layer.WMS(
				"北京", "http://localhost:8080/geoserver/china/wms",
				{
					LAYERS: 'china:beijing',
					STYLES: '',
					format: format,
					tiled: true,
					transparent: "true",
					tilesOrigin : map.maxExtent.left + ',' + map.maxExtent.bottom
				},
				{
					buffer: 0,
					displayOutsideMaxExtent: true,
					isBaseLayer: false,
					yx : {'EPSG:4326' : true}
				}
			);
			//var vectorLayer = new OpenLayers.Layer.Vector("编辑图层", {
			//		strategies: [new OpenLayers.Strategy.Fixed()],
			//		protocol: new OpenLayers.Protocol.WFS({
			//			url: "http://localhost:8080/geoserver/wfs",
			//			featurePrefix: 'china',
			//			featureType: 'ln_city file'
			//		})
			//		});
			var save = new OpenLayers.Strategy.Save();
			save.events.on({
					'success': function () {
						alert("add")
					}
			});
			vectorLayer = new OpenLayers.Layer.Vector("辽宁", {
				projection: new OpenLayers.Projection("EPSG:4326"),
				strategies: [new OpenLayers.Strategy.Fixed()
					,save
					,new OpenLayers.Strategy.Refresh()],
					protocol: new OpenLayers.Protocol.WFS({
					url:  "http://192.168.196.189:8080/geoserver/wfs",
					version: "1.1.0",
					featurePrefix: "china",
					featureType: "ln_city",
					featureNS: "http://www.neusoft.com/china",
					srsName : "EPSG:4326",
					isBaseLayer: false,
					outputFormat: "json",
					geometryName : "the_geom"
				})
			});
			
			map.addLayer(tiled);
			map.addLayer(liaoning);
			map.addLayer(beijing);
			map.addControl(new OpenLayers.Control.EditingToolbar(vectorLayer));
			map.addControl(new OpenLayers.Control.LayerSwitcher());
			layerTree = new MuleGIS.Control.LayerTree())
			map.addControl(layerTree);
			map.addControl(new MuleGIS.Control.ScaleLine());
			var positionControl = new MuleGIS.Control.MousePosition({element: $('#location').get(0)});
			map.addControl(positionControl);
			var overView = new MuleGIS.Control.Overview({
				maximizeTitle: '展开鹰眼图',
				minimizeTitle: '折叠鹰眼图'
			});
			map.addControl(overView);
			var navigation = new MuleGIS.Control.Navigation({
				position: new OpenLayers.Pixel(2, 15)
			});
			//navigation.zoomWheelEnabled = false;
			map.addControl(navigation);
			map.zoomToMaxExtent();
		};

		$('#layer-manage').click(
			
		);
		$(function(){
			$('#map').setHeight($('#headDiv'));
			$(window).resize($('#map').setHeight($('#headDiv')));
			initMap();
		});
		$("#inputButton").click(function () {
			vectorLayer.strategies[1].save();
			vectorLayer.strategies[2].refresh();
		});
	</script>
  </body>
</html>
